{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/search/page.tsx"],"sourcesContent":["import { Suspense } from 'react';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport { ChevronRight, MapPin, Search } from 'lucide-react';\nimport type { Metadata } from 'next';\n\nconst WP_API_BASE = \"https://dir.lascrucesdirectory.com/wp-json/geodir/v2\";\n\ninterface SearchResult {\n  id: number;\n  slug: string;\n  title: string;\n  type: string;\n  typeLabel: string;\n  city?: string;\n  category?: string;\n  image?: string;\n}\n\ninterface Props {\n  searchParams: Promise<{ q?: string }>;\n}\n\nexport async function generateMetadata({ searchParams }: Props): Promise<Metadata> {\n  const params = await searchParams;\n  const query = params.q || '';\n  \n  return {\n    title: query ? `Search results for \"${query}\"` : 'Search',\n    description: `Find local businesses, restaurants, accommodations, and places in Las Cruces${query ? ` matching \"${query}\"` : ''}.`,\n  };\n}\n\nfunction decodeHtmlEntities(text: string): string {\n  const entities: Record<string, string> = {\n    \"&amp;\": \"&\",\n    \"&lt;\": \"<\",\n    \"&gt;\": \">\",\n    \"&quot;\": '\"',\n    \"&#039;\": \"'\",\n    \"&#8217;\": \"'\",\n    \"&#8216;\": \"'\",\n    \"&#8220;\": '\"',\n    \"&#8221;\": '\"',\n    \"&#038;\": \"&\",\n  };\n  return text.replace(/&[#a-z0-9]+;/gi, (match) => entities[match] || match);\n}\n\nfunction getListingImage(listing: any): string | undefined {\n  if (listing.featured_image?.src) {\n    return `/api/image-proxy?url=${encodeURIComponent(listing.featured_image.src)}`;\n  }\n  if (listing.images?.[0]?.src) {\n    return `/api/image-proxy?url=${encodeURIComponent(listing.images[0].src)}`;\n  }\n  return undefined;\n}\n\nasync function searchListings(query: string): Promise<SearchResult[]> {\n  if (!query || query.length < 2) return [];\n\n  const endpoints = [\n    { type: 'restaurant', label: 'Restaurant', url: `${WP_API_BASE}/restaurant?search=${encodeURIComponent(query)}&per_page=50` },\n    { type: 'business', label: 'Business', url: `${WP_API_BASE}/business?search=${encodeURIComponent(query)}&per_page=50` },\n    { type: 'accommodation', label: 'Accommodation', url: `${WP_API_BASE}/accommodation?search=${encodeURIComponent(query)}&per_page=50` },\n    { type: 'places', label: 'Place', url: `${WP_API_BASE}/places?search=${encodeURIComponent(query)}&per_page=50` },\n  ];\n\n  const responses = await Promise.all(\n    endpoints.map(async ({ type, label, url }) => {\n      try {\n        const res = await fetch(url, { next: { revalidate: 300 } });\n        if (!res.ok) return [];\n        const data = await res.json();\n        return data.map((item: any) => ({\n          id: item.id,\n          slug: item.slug,\n          title: decodeHtmlEntities(item.title?.rendered || item.title || ''),\n          type,\n          typeLabel: label,\n          city: item.city || item.location?.city,\n          category: item.post_category?.[0]?.name?.replace(/&amp;/g, '&'),\n          image: getListingImage(item),\n        }));\n      } catch {\n        return [];\n      }\n    })\n  );\n\n  return responses.flat();\n}\n\nconst typeColors: Record<string, string> = {\n  restaurant: 'bg-orange-100 text-orange-700',\n  business: 'bg-blue-100 text-blue-700',\n  accommodation: 'bg-purple-100 text-purple-700',\n  places: 'bg-green-100 text-green-700',\n};\n\nconst defaultImages: Record<string, string> = {\n  restaurant: 'https://images.pexels.com/photos/262978/pexels-photo-262978.jpeg?auto=compress&cs=tinysrgb&w=400',\n  business: 'https://images.pexels.com/photos/380768/pexels-photo-380768.jpeg?auto=compress&cs=tinysrgb&w=400',\n  accommodation: 'https://images.pexels.com/photos/271624/pexels-photo-271624.jpeg?auto=compress&cs=tinysrgb&w=400',\n  places: 'https://images.pexels.com/photos/2739664/pexels-photo-2739664.jpeg?auto=compress&cs=tinysrgb&w=400',\n};\n\nasync function SearchResultsContent({ query }: { query: string }) {\n  const results = await searchListings(query);\n\n  if (!query) {\n    return (\n      <div className=\"text-center py-16\">\n        <Search className=\"w-16 h-16 text-slate-300 mx-auto mb-4\" aria-hidden=\"true\" />\n        <h2 className=\"text-2xl font-bold text-slate-900 mb-2\">Search the Directory</h2>\n        <p className=\"text-slate-600\">Enter a search term to find local businesses, restaurants, and more.</p>\n      </div>\n    );\n  }\n\n  if (results.length === 0) {\n    return (\n      <div className=\"text-center py-16\">\n        <Search className=\"w-16 h-16 text-slate-300 mx-auto mb-4\" aria-hidden=\"true\" />\n        <h2 className=\"text-2xl font-bold text-slate-900 mb-2\">No results found</h2>\n        <p className=\"text-slate-600\">Try a different search term or browse our categories.</p>\n        <div className=\"flex flex-wrap justify-center gap-4 mt-8\">\n          <Link href=\"/restaurant\" className=\"px-6 py-3 bg-orange-100 text-orange-700 rounded-xl font-medium hover:bg-orange-200 transition-colors\">\n            Restaurants\n          </Link>\n          <Link href=\"/business\" className=\"px-6 py-3 bg-blue-100 text-blue-700 rounded-xl font-medium hover:bg-blue-200 transition-colors\">\n            Businesses\n          </Link>\n          <Link href=\"/accommodation\" className=\"px-6 py-3 bg-purple-100 text-purple-700 rounded-xl font-medium hover:bg-purple-200 transition-colors\">\n            Accommodations\n          </Link>\n          <Link href=\"/places\" className=\"px-6 py-3 bg-green-100 text-green-700 rounded-xl font-medium hover:bg-green-200 transition-colors\">\n            Places\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const groupedResults = results.reduce((acc, result) => {\n    if (!acc[result.type]) acc[result.type] = [];\n    acc[result.type].push(result);\n    return acc;\n  }, {} as Record<string, SearchResult[]>);\n\n  return (\n    <div className=\"space-y-12\">\n      <p className=\"text-slate-600\">\n        Found <span className=\"font-semibold text-slate-900\">{results.length}</span> results for \"{query}\"\n      </p>\n\n      {Object.entries(groupedResults).map(([type, items]) => (\n        <section key={type}>\n          <h2 className=\"text-xl font-bold text-slate-900 mb-6 flex items-center gap-2\">\n            <span className={`px-3 py-1 rounded-full text-sm ${typeColors[type]}`}>\n              {items[0].typeLabel}s\n            </span>\n            <span className=\"text-slate-400 font-normal text-base\">({items.length})</span>\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {items.map((result) => (\n              <article key={`${result.type}-${result.id}`}>\n                <Link\n                  href={`/${result.type}/${result.slug}`}\n                  className=\"group block bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2\"\n                >\n                  <div className=\"relative h-48 overflow-hidden\">\n                    <Image\n                      src={result.image || defaultImages[result.type]}\n                      alt={result.title}\n                      fill\n                      sizes=\"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw\"\n                      className=\"object-cover group-hover:scale-105 transition-transform duration-300\"\n                    />\n                  </div>\n                  <div className=\"p-4\">\n                    <h3 className=\"font-semibold text-slate-900 group-hover:text-emerald-600 transition-colors truncate\">\n                      {result.title}\n                    </h3>\n                    <div className=\"flex items-center gap-2 mt-2\">\n                      {result.city && (\n                        <span className=\"text-sm text-slate-500 flex items-center gap-1\">\n                          <MapPin className=\"w-3 h-3\" aria-hidden=\"true\" />\n                          {result.city}\n                        </span>\n                      )}\n                      {result.category && (\n                        <span className=\"text-xs px-2 py-0.5 bg-slate-100 text-slate-600 rounded-full\">\n                          {result.category}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </Link>\n              </article>\n            ))}\n          </div>\n        </section>\n      ))}\n    </div>\n  );\n}\n\nexport default async function SearchPage({ searchParams }: Props) {\n  const params = await searchParams;\n  const query = params.q || '';\n\n  return (\n    <main>\n      <section className=\"bg-gradient-to-br from-slate-900 via-slate-800 to-emerald-900 py-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <nav aria-label=\"Breadcrumb\" className=\"flex items-center space-x-2 text-sm text-slate-300 mb-6\">\n            <Link href=\"/\" className=\"hover:text-white transition-colors\">\n              Home\n            </Link>\n            <ChevronRight className=\"w-4 h-4\" aria-hidden=\"true\" />\n            <span className=\"text-white\">Search</span>\n          </nav>\n\n          <h1 className=\"text-4xl md:text-5xl font-bold text-white mb-4\">\n            {query ? `Results for \"${query}\"` : 'Search'}\n          </h1>\n          <p className=\"text-xl text-slate-300\">\n            Find businesses, restaurants, accommodations, and places in Las Cruces\n          </p>\n        </div>\n      </section>\n\n      <section className=\"py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <Suspense fallback={\n            <div className=\"text-center py-16\">\n              <div className=\"animate-pulse\">\n                <div className=\"h-8 w-48 bg-slate-200 rounded mx-auto mb-4\"></div>\n                <div className=\"h-4 w-64 bg-slate-100 rounded mx-auto\"></div>\n              </div>\n            </div>\n          }>\n            <SearchResultsContent query={query} />\n          </Suspense>\n        </div>\n      </section>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}